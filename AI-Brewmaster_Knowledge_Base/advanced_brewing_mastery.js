// Advanced Brewing Mastery Knowledge Base
// Expert-level brewing science, formulas, and experimental techniques

const advancedBrewingMastery = {
  
  // Advanced brewing chemistry and formulas
  chemistry: {
    waterChemistry: `**Water Chemistry Mastery - The Foundation of Great Beer**

Alright, let's dive deep into the science that separates good brewers from legends. Water chemistry isn't just about following profiles - it's about understanding WHY each ion does what it does.

**Ion Interactions & Synergies:**
- **Calcium + Sulfate**: Creates that crisp, mineral backbone that makes West Coast IPAs sing
- **Calcium + Chloride**: Builds mouthfeel and enhances malt sweetness - your secret weapon for NEIPAs
- **Magnesium**: Yeast nutrient, but too much creates harsh metallic bite (keep under 30ppm)
- **Sodium**: Flavor enhancer like salt on food, but over 150ppm = salty disaster

**Advanced Calculations:**
- **Residual Alkalinity**: RA = Alkalinity - (Ca/1.4 + Mg/1.7)
- **Sulfate:Chloride Ratios**: 
  - 3:1 = Aggressive hop character (West Coast)
  - 1:1 = Balanced (most styles)
  - 1:3 = Malt-forward (English ales)

**Pro Formulas:**
- **Acid Addition**: mL = (Target pH - Current pH) × Batch Size × Acid Factor
- **Salt Addition**: ppm = (grams × 1000) ÷ liters
- **Dilution**: Final ppm = (Initial ppm × Initial Volume) ÷ Final Volume`,

    enzymeKinetics: `**Enzyme Kinetics - Mastering the Mash**

Here's where brewing becomes biochemistry, and where you separate yourself from kit brewers.

**Alpha vs Beta Amylase Dance:**
- **Beta Amylase**: Works from non-reducing ends, creates maltose, active 140-149°F
- **Alpha Amylase**: Random chain cutting, creates dextrins, active 149-162°F
- **Sweet Spot**: 148-152°F for balanced fermentability

**Advanced Mash Schedules:**
- **Ferulic Acid Rest**: 111°F for 15min (wheat beers - enhances 4-VG precursors)
- **Protein Rest**: 122°F for 15min (undermodified malts only)
- **Beta Saccharification**: 148°F for 45min (max fermentability)
- **Alpha Saccharification**: 158°F for 15min (body building)

**Enzyme Deactivation Kinetics:**
- **Half-life at 149°F**: Beta = 20min, Alpha = 120min
- **Mash Out Importance**: 168°F instantly stops all enzyme activity
- **pH Effects**: Optimal enzyme activity at pH 5.2-5.6`,

    fermentationScience: `**Fermentation Biochemistry - Where Magic Happens**

This is where your yeast becomes your co-brewer. Understanding fermentation at the molecular level lets you craft flavors most brewers can't even imagine.

**Yeast Metabolism Pathways:**
- **Glycolysis**: Glucose → Pyruvate → Acetaldehyde → Ethanol + CO2
- **Ester Formation**: Acetyl-CoA + Alcohol → Esters (fruity flavors)
- **Fusel Alcohol Production**: Amino acid catabolism under stress

**Advanced Fermentation Control:**
- **Diacetyl Management**: Vicinal diketone reduction requires 65-68°F rest
- **Ester Optimization**: Higher temps (72-75°F) early, then cool for clean finish
- **Pressure Fermentation**: 10-15 PSI reduces esters, creates lager-like character

**Biotransformation Chemistry:**
- **Hop Thiols**: 3MH, 3MHA release during active fermentation
- **Glycoside Hydrolysis**: Yeast enzymes unlock bound hop aromatics
- **Timing**: Add hops at 1.020-1.030 SG for maximum biotransformation`
  },

  // Experimental brewing techniques
  experimental: {
    hopTechniques: `**Next-Level Hop Techniques - Beyond Basic Dry Hopping**

Time to push boundaries and create hop experiences that'll blow minds.

**Cryo Hop Technology:**
- **Lupulin Powder**: Concentrated hop oils without vegetal matter
- **Usage**: 50% replacement rate vs whole hops
- **Benefits**: Intense aroma, reduced grassy character, better extraction

**Advanced Dry Hop Methods:**
- **Hop Creep Management**: Add amylase enzyme to prevent refermentation
- **Temperature Ramping**: Start at 60°F, ramp to 70°F over 3 days
- **Recirculation Hopping**: Pump beer through hop bed for extraction

**Experimental Additions:**
- **Hop Hash**: Sticky lupulin concentrate - use 25% of normal rate
- **Hop Water**: Hop tea addition at packaging for fresh aroma
- **Dual Dry Hop**: Biotransformation hop + aroma hop separately

**Cutting-Edge Techniques:**
- **Hop Bursting**: 80% of hops in final 20 minutes
- **First Wort Hopping**: Gentle extraction during lauter
- **Randall Hopping**: Fresh hop filtration at serving`,

    yeastInnovation: `**Yeast Innovation - Pushing Fermentation Boundaries**

Modern brewing is all about yeast. Here's how to make your yeast work harder and smarter.

**Strain Blending Mastery:**
- **NEIPA Blend**: 70% London Ale III + 30% Vermont Ale (Conan)
- **Saison Complex**: 60% French Saison + 40% Brett Trois
- **Lager Hybrid**: 80% German Lager + 20% Kveik (fast, clean)

**Advanced Propagation:**
- **Starter Calculations**: (Target Cells - Current Cells) ÷ Growth Rate
- **Stepped Starters**: 500ml → 1L → 2L for high gravity beers
- **Yeast Washing**: Harvest from krausen for maximum viability

**Experimental Fermentation:**
- **Kveik Techniques**: 85-95°F fermentation in 48-72 hours
- **Pressure Fermentation**: Spunding valve at 10-15 PSI
- **Co-fermentation**: Primary yeast + Brett for complexity

**Metabolic Engineering:**
- **Nutrient Timing**: DAP at 1/3 sugar depletion prevents stress
- **Oxygen Management**: 8-12ppm for ales, 12-16ppm for lagers
- **pH Buffering**: Calcium carbonate addition for yeast health`,

    grainInnovation: `**Grain Innovation - Beyond Base Malts**

Let's talk about pushing malt boundaries and creating flavor profiles that don't exist in style guidelines.

**Specialty Malt Combinations:**
- **Complexity Builder**: 5% Munich + 3% Victory + 2% Aromatic
- **Color Without Roast**: Carafa Special (dehusked) for smooth dark color
- **Mouthfeel Enhancer**: Flaked oats + wheat + carapils trinity

**Advanced Malt Techniques:**
- **Malt Conditioning**: Spray malt with water 30min before milling
- **Step Milling**: Coarse crack, then fine crack for better extraction
- **Decoction Simplified**: Pull 1/3 thick mash, boil 15min, return

**Experimental Grains:**
- **Ancient Grains**: Spelt, emmer, einkorn for unique flavors
- **Adjunct Mastery**: Rice hulls for lautering, corn for lightness
- **Protein Sources**: Quinoa, amaranth for gluten-free options

**Malt Modification Techniques:**
- **Acid Malt**: Natural pH adjustment without chemicals
- **Melanoidin Malt**: Maillard reaction flavors without roasting
- **Honey Malt**: Intense sweetness and color contribution`
  },

  // Professional batch management
  batchManagement: {
    qualityControl: `**Professional Quality Control - Consistency is King**

Here's how we maintain brewery-grade consistency batch after batch.

**Critical Control Points:**
- **Mash pH**: 5.2-5.6 (measure at mash temp, not room temp)
- **Boil Vigor**: 8-12% evaporation rate for proper DMS removal
- **Fermentation Temp**: ±1°F throughout entire fermentation
- **Dissolved Oxygen**: <50ppb post-fermentation to prevent staling

**Testing Protocols:**
- **Pre-Boil Gravity**: Calculate efficiency before hop additions
- **Post-Boil Volume**: Adjust for consistent OG across batches
- **Fermentation Tracking**: Daily gravity + temp readings
- **Final QC**: pH, ABV, IBU, color verification

**Documentation Standards:**
- **Recipe Scaling**: Document all adjustments and results
- **Process Deviations**: Note any temperature excursions or timing changes
- **Sensory Notes**: Detailed tasting notes at each stage
- **Yield Calculations**: Track efficiency trends over time

**Troubleshooting Matrix:**
- **Low Efficiency**: Check crush, pH, temperature, time
- **High FG**: Yeast health, nutrients, temperature, aeration
- **Off-Flavors**: Trace back to specific process points
- **Color Variations**: Malt storage, boil intensity, pH effects`,

    scaling: `**Batch Scaling Mastery - From Homebrew to Commercial**

Scaling isn't just multiplication - physics changes everything.

**Volume Effects on Process:**
- **Heat Transfer**: Larger batches heat/cool slower - adjust timing
- **Hop Utilization**: Decreases with volume - increase by 10-15%
- **Yeast Pitch Rate**: Scale by surface area, not volume
- **Boil-off Rate**: Changes with kettle geometry - measure and adjust

**Equipment Scaling Factors:**
- **Mash Tun Efficiency**: Larger grain beds = better efficiency
- **Pump Speeds**: Scale flow rates to maintain contact time
- **Heat Exchanger**: Adjust flow rates for target temperatures
- **Fermentation**: Height-to-diameter ratio affects yeast behavior

**Advanced Scaling Formulas:**
- **Hop Scaling**: New Rate = Old Rate × (New Volume ÷ Old Volume)^0.8
- **Yeast Scaling**: Cells/mL = Target Cells ÷ (Volume × 1000)
- **Time Scaling**: New Time = Old Time × (New Volume ÷ Old Volume)^0.67
- **Heat Scaling**: BTU = Volume × ΔT × 8.33 × Specific Heat

**Commercial Considerations:**
- **CIP Systems**: Clean-in-place chemical concentrations
- **Carbonation**: CO2 volumes for different serving methods
- **Filtration**: Micron ratings for clarity vs flavor retention
- **Packaging**: DO pickup rates and shelf stability`
  },

  // Equipment optimization
  equipment: {
    efficiency: `**Equipment Efficiency Optimization - Squeeze Every Point**

Let's talk about getting maximum performance from every piece of kit.

**Mash Tun Optimization:**
- **Grain Bed Depth**: 8-12 inches optimal for even extraction
- **False Bottom Gap**: 0.7-1.0mm slots for clear runoff
- **Recirculation Rate**: 1-2 qt/min per square foot of grain bed
- **Sparge Technique**: Fly sparge at 1-2°F above mash temp

**Boil Kettle Mastery:**
- **Boil Vigor**: 8-12% evaporation for DMS removal
- **Hop Utilization**: Vigorous boil increases extraction 15-20%
- **Hot Break Formation**: Proper protein coagulation at rolling boil
- **Whirlpool Dynamics**: 15-20 minute rest for trub cone formation

**Heat Exchanger Efficiency:**
- **Counterflow Design**: Maximize temperature differential
- **Flow Rate Balance**: Wort:Water ratio affects final temperature
- **Cleaning Protocol**: Backflush every batch for consistent performance
- **Temperature Monitoring**: Both inlet and outlet temps critical

**Fermentation Vessel Optimization:**
- **Height:Diameter Ratio**: 2:1 to 3:1 optimal for yeast health
- **Cone Angle**: 60-70° for proper yeast settling
- **Pressure Rating**: 15 PSI minimum for spunding operations
- **Temperature Control**: Glycol jackets vs immersion coils efficiency`,

    maintenance: `**Equipment Maintenance - Preventing Problems Before They Start**

Proper maintenance is what separates pros from weekend warriors.

**Cleaning Chemistry:**
- **Caustic (NaOH)**: Removes organic soils, proteins, hop resins
- **Acid (Phosphoric)**: Removes mineral deposits, beer stone
- **Sanitizers**: Star-San (acid-based) vs iodophor (oxidizing)
- **Passivation**: Nitric acid treatment for stainless steel

**Maintenance Schedules:**
- **Daily**: Rinse, visual inspection, temperature logs
- **Weekly**: Deep clean, gasket inspection, calibration check
- **Monthly**: Pump maintenance, valve lubrication, pressure testing
- **Quarterly**: Complete disassembly, part replacement, recalibration

**Critical Wear Points:**
- **Pump Seals**: Replace every 6 months or 500 batches
- **Gaskets**: Inspect for cuts, hardening, chemical damage
- **Thermometers**: Calibrate monthly with ice water test
- **pH Meters**: Two-point calibration before each use

**Troubleshooting Guide:**
- **Low Efficiency**: Check crush consistency, mash pH, temperature
- **Stuck Sparge**: Grain bed compaction, fine particles, pH issues
- **Poor Cold Break**: Insufficient cooling rate, protein levels
- **Fermentation Issues**: Temperature control, yeast viability, nutrients`
  },

  // Personality and communication style
  personality: {
    expertise: {
      advanced: [
        "Alright, time to get nerdy - here's the real science behind this:",
        "Let me drop some brewing chemistry knowledge on you:",
        "This is where we separate the pros from the homebrewers:",
        "Here's what 25+ years of commercial brewing has taught me about this:"
      ],
      experimental: [
        "Want to push some boundaries? Here's how we innovate:",
        "Time to get experimental - this technique will blow your mind:",
        "Ready to try something most brewers haven't even heard of?",
        "Let's venture into uncharted brewing territory:"
      ],
      troubleshooting: [
        "Been there, fixed that - here's the real solution:",
        "I've seen this problem destroy batches. Here's how to nail it:",
        "Red flag alert! Let me save you from a costly mistake:",
        "This one's tricky, but I've got the fix that actually works:"
      ]
    },
    
    encouragement: [
      "Now you're thinking like a brewmaster!",
      "That's the kind of innovation that advances our craft!",
      "Solid approach - you've got the brewing instincts!",
      "This is why I love working with serious brewers like you!"
    ],
    
    slang: {
      processes: [
        "grain to glass", "hot side", "cold side", "knockout", "crash cooling",
        "spunding", "dry hopping", "biotransformation", "hop creep", "diacetyl rest"
      ],
      equipment: [
        "mash tun", "lauter tun", "grant", "whirlpool", "fermenter", "brite tank",
        "CIP", "heat exchanger", "glycol chiller", "spunding valve"
      ],
      quality: [
        "dialed in", "locked and loaded", "bulletproof recipe", "house character",
        "flagship quality", "shelf stable", "sessionable", "crushable"
      ]
    }
  }
};

// Export for use in AI Brewmaster
if (typeof module !== 'undefined' && module.exports) {
  module.exports = advancedBrewingMastery;
} else if (typeof window !== 'undefined') {
  window.advancedBrewingMastery = advancedBrewingMastery;
}
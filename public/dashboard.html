<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brewery Dashboard - BrewMetrics</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="google-reviews-styles.css">
    <link rel="stylesheet" href="advanced-analytics-styles.css">
    
    <!-- Enhanced UI Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tippy.js/6.3.7/tippy.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/notyf/3.10.0/notyf.min.css" rel="stylesheet">
    
    <!-- Enhanced UI Styles -->
    <link href="enhanced-ui.css" rel="stylesheet">
    <link href="advanced-components.css" rel="stylesheet">
    
    <!-- Brewery Theme -->
    <link href="brewery-theme.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Enhanced UI Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tippy.js/6.3.7/tippy-bundle.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/notyf/3.10.0/notyf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

    <style>
        /* Existing styles from your HTML for modals and feedback items - Preserved */
        #feedback-summary-container ul li.feedback-summary-item:not(.no-data) {
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        #feedback-summary-container ul li.feedback-summary-item:not(.no-data):hover {
            background-color: #f0f0f0; 
        }
        .feedback-detail-modal, .comparison-modal {
            position: fixed; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); 
            display: flex;
            justify-content: center; align-items: center; z-index: 1050;
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s linear 0.3s;
        }
        .feedback-detail-modal.visible, .comparison-modal.visible {
            opacity: 1; visibility: visible;
            transition: opacity 0.3s ease, visibility 0s linear 0s;
        }
        .feedback-detail-modal .modal-content, .comparison-modal .modal-content {
            background-color: #fff; 
            padding: 25px 30px; border-radius: 8px; 
            width: 85%; max-width: 950px; max-height: 90vh;
            display: flex; flex-direction: column; box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
            position: relative; overflow: hidden;
        }
        .comparison-modal .modal-content { max-width: 1200px; } /* Increased max-width for potentially more charts */
        .comparison-modal .comparison-grid {
            display: flex; gap: 20px; overflow-y: auto;
            padding-top: 10px; flex-grow: 1;
        }
        .comparison-modal .comparison-column { flex: 1; min-width: 0; }
        .comparison-modal h3 {
            text-align: center; margin-bottom: 15px; font-size: 1.1em;
            color: var(--brew-brown);
            border-bottom: 1px solid #eee; padding-bottom: 8px;
        }
        .comparison-modal canvas { margin-bottom: 20px; max-width: 100%; max-height: 220px; }
        .feedback-detail-modal .close-modal-button, .comparison-modal .close-modal-button {
            position: absolute; top: 10px; right: 15px; font-size: 1.8em;
            font-weight: bold; color: #aaa; cursor: pointer; line-height: 1; padding: 0 5px;
            background: none; border: none;
        }
        .feedback-detail-modal .close-modal-button:hover, .comparison-modal .close-modal-button:hover { color: #333; }
        .feedback-detail-modal h3, .comparison-modal h2 {
            margin-top: 0; margin-bottom: 15px; border-bottom: 1px solid #eee; 
            padding-bottom: 10px; flex-shrink: 0;
            color: var(--brew-deep-brown); font-family: var(--font-family-headings);
        }
        .feedback-detail-modal .controls {
            margin-bottom: 15px; display: flex; gap: 15px;
            align-items: center; flex-shrink: 0;
        }
        .feedback-detail-modal .controls label { font-weight: 600; margin-right: 5px; }
        .feedback-table-container {
            flex-grow: 1; overflow-y: auto; border: 1px solid #dee2e6;
            border-radius: 4px; margin-bottom: 15px;
        }
        .feedback-table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
        .feedback-table th, .feedback-table td {
            border: 1px solid #dee2e6; padding: 6px 8px;
            text-align: left; vertical-align: top;
        }
        .feedback-table thead th {
            background-color: #e9ecef; position: sticky; top: 0;
            z-index: 1; font-weight: 600;
        }
        .feedback-table tbody tr:nth-child(even) { background-color: #f8f9fa; }
        .feedback-table tbody tr:hover { background-color: #f1f1f1; }
        .feedback-table .rating-col { text-align: center; width: 60px; }
        .feedback-table .timestamp-col { white-space: nowrap; width: 150px; }

        .batch-analytics-area {
            background-color: #fafafa; border: 1px solid #eee; border-top: none;
            padding: 15px; margin: 10px -25px -20px -25px;
            margin-top: 15px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px; display: none;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }
        .batch-analytics-area.visible { display: grid; }
        .batch-analytics-area .chart-container { max-height: 250px; position: relative; } /* Ensure this can accommodate chart legends if needed */
        .batch-analytics-area h5 {
            margin-top: 0; margin-bottom: 8px; text-align: center;
            font-size: 0.9em; color: var(--brew-dark-text);
        }
        .chart-message {font-size: 0.8em; text-align: center; color: var(--dark-grey); margin-top: 5px;}

        .whats-new-banner {
            background-color: var(--white); padding: 20px 25px; margin-bottom: 25px;
            border-radius: var(--border-radius); box-shadow: var(--box-shadow-light);
            border: 1px solid var(--border-color-light, #eee);
        }
        .whats-new-banner h3 { margin-top: 0; color: var(--brew-dark); font-size: 1.3em;}
        .whats-new-banner p { margin-bottom: 15px; font-size: 0.95em; line-height: 1.5;}
        .whats-new-banner .buttons .btn { margin-right: 10px; }
        .whats-new-banner .buttons .btn-primary {
             background-color: var(--brew-amber); border-color: var(--brew-amber);
             color: var(--brew-deep-brown, var(--brew-dark));
        }
         .whats-new-banner .buttons .btn-secondary {
             background-color: var(--brew-off-white); border-color: var(--medium-grey);
             color: var(--brew-dark);
        }
        .main-dashboard-title-bar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px;
        }
        .main-dashboard-title-bar h2 {
            margin: 0; font-size: 1.8em; color: var(--brew-deep-brown, var(--brew-dark));
            font-family: var(--font-family-headings);
        }
        .main-dashboard-title-bar .action-buttons .btn { margin-left: 10px; }
        .main-dashboard-title-bar .action-buttons .btn-export {
            background-color: var(--brew-muted-green); border-color: var(--brew-muted-green); color: white;
        }
        .main-dashboard-title-bar .action-buttons .btn-new-batch {
             background-color: var(--brew-amber); border-color: var(--brew-amber);
             color: var(--brew-deep-brown, var(--brew-dark));
        }
        .summary-cards-container {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 25px; margin-bottom: 30px;
        }
        .summary-card {
            background-color: var(--white); border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-light); border: 1px solid var(--border-color-light, #eee);
            display: flex; flex-direction: column;
        }
        .summary-card-content { padding: 20px; display: flex; align-items: center; gap: 15px; flex-grow: 1;}
        .summary-card-icon {
            font-size: 1.8em; padding: 12px;
            border-radius: 50%; color: var(--white); width: 50px; height: 50px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .summary-card-icon.batches { background-color: #3498db; }
        .summary-card-icon.feedback { background-color: #2ecc71; }
        .summary-card-icon.reviews { background-color: #f1c40f; }
        .summary-card-icon.discounts { background-color: #e67e22; }
        .summary-card-info h4 { margin: 0 0 5px 0; font-size: 0.9em; color: var(--brew-muted-text, var(--dark-grey)); font-weight: 600;}
        .summary-card-info .value { font-size: 1.8em; font-weight: 700; color: var(--brew-dark-text, var(--brew-dark));}
        .summary-card-info .value small { font-size: 0.6em; font-weight: normal; color: var(--dark-grey); }
        .summary-card-footer {
            background-color: var(--brew-tan, #FFF8DC);
            padding: 10px 20px; text-align: left;
            border-top: 1px solid var(--border-color-light, #eee);
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }
        .summary-card-footer a { color: var(--brew-amber); text-decoration: none; font-weight: 600; font-size: 0.9em;}
        .summary-card-footer a:hover { text-decoration: underline; }

        .top-right-icons { display: flex; align-items: center; gap: 20px; }
        .top-right-icons .icon-button { font-size: 1.3em; color: var(--brew-muted-text, var(--dark-grey)); cursor: pointer;}
        .top-right-icons .icon-button:hover { color: var(--brew-dark-text, var(--brew-dark));}

        #top-rated-beers-controls { margin-bottom: 15px; display: flex; align-items: center; gap: 10px;}
        #top-rated-beers-controls label { font-weight: 600; font-size: 0.9em;}
        #top-rated-time-select { padding: 6px 10px; border-radius: var(--border-radius); border: 1px solid var(--medium-grey); font-size: 0.9em;}
        #top-rated-beers-list { list-style: none; padding-left: 0; }
        #top-rated-beers-list li {
            padding: 10px 0;
            border-bottom: 1px dotted var(--border-color-light, #eee);
            font-size: 0.95em;
        }
         #top-rated-beers-list li:last-child { border-bottom: none; }
        #top-rated-beers-list strong { color: var(--brew-dark-text, var(--brew-dark));}
        #top-rated-beers-list small { color: var(--dark-grey); font-size: 0.9em;}
        #top-rated-beers-list .avg-rating-display { color: var(--brew-amber); font-weight: bold; }

        /* AI Assistant Styles */
        .ai-status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        
        .ai-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #2ecc71;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .ai-chat-container {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #fafafa;
            margin-bottom: 20px;
        }
        
        .ai-chat-messages {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background-color: white;
            border-radius: 8px 8px 0 0;
        }
        
        .ai-message {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            align-items: flex-start;
        }
        
        .ai-message.user {
            flex-direction: row-reverse;
        }
        
        .ai-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--brew-amber);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
            flex-shrink: 0;
        }
        
        .ai-message.user .ai-avatar {
            background-color: var(--brew-link-blue);
        }
        
        .ai-message-content {
            flex: 1;
            background-color: #f8f9fa;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
        }
        
        .ai-message.user .ai-message-content {
            background-color: var(--brew-link-blue);
            color: white;
        }
        
        .ai-message-content p {
            margin: 0 0 8px 0;
        }
        
        .ai-message-content p:last-child {
            margin-bottom: 0;
        }
        
        .ai-message-content ul {
            margin: 8px 0;
            padding-left: 20px;
        }
        
        .ai-message-content li {
            margin-bottom: 4px;
        }
        
        .ai-chat-input-container {
            display: flex;
            gap: 10px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 0 0 8px 8px;
        }
        
        #ai-prompt {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 24px;
            font-size: 0.95em;
            outline: none;
            transition: border-color 0.2s;
        }
        
        #ai-prompt:focus {
            border-color: var(--brew-link-blue);
        }
        
        #ai-send {
            width: 48px;
            height: 48px;
            border: none;
            background-color: var(--brew-link-blue);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            transition: background-color 0.2s;
        }
        
        #ai-send:hover:not(:disabled) {
            background-color: #2980b9;
        }
        
        #ai-send:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .ai-quick-actions {
            margin-top: 15px;
        }
        
        .ai-quick-actions h4 {
            margin: 0 0 12px 0;
            font-size: 1em;
            color: var(--brew-dark);
        }
        
        .quick-action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .ai-action-btn {
            padding: 8px 16px;
            border: 1px solid var(--brew-amber);
            background-color: white;
            color: var(--brew-amber);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .ai-action-btn:hover {
            background-color: var(--brew-amber);
            color: white;
        }
        
        .ai-message.thinking .ai-message-content {
            background-color: #e8f4f8;
            font-style: italic;
            color: #666;
        }
        
        .ai-typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }
        
        .ai-typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #666;
            animation: typing 1.4s infinite;
        }
        
        .ai-typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .ai-typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Particles Background -->
    <div id="particles-js" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1;"></div>
    
    <div id="loading-indicator" style="display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 1.2em;">
        <div class="loading-content animate__animated animate__fadeIn">
            <div class="loading-spinner"></div>
            <p style="margin-top: 20px;">Loading BrewMetrics Dashboard...</p>
        </div>
    </div>

    <div id="app-container" class="hidden">
        <aside id="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-beer sidebar-logo"></i>
                <h2>BrewMetrics</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="#dashboard-overview-section" class="nav-link active-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                <a href="#batch-management-section" class="nav-link"><i class="fas fa-boxes"></i> Batch Management</a>
                <a href="#survey-templates-section" class="nav-link"><i class="fas fa-file-alt"></i> Survey Templates</a>
                <a href="#customer-engagement-section" class="nav-link"><i class="fas fa-users"></i> Customer Engagement</a>
                <a href="#google-reviews-section" class="nav-link"><i class="fab fa-google"></i> Google Reviews</a>
                <a href="#advanced-analytics-section" class="nav-link"><i class="fas fa-chart-line"></i> Advanced Analytics</a>
                <a href="#batch-comparison-section" class="nav-link"><i class="fas fa-balance-scale"></i> Batch Comparison</a>
                <a href="#qr-code-section" class="nav-link"><i class="fas fa-qrcode"></i> QR Code Gen</a>
                <a href="#batch-entry-section" class="nav-link"><i class="fas fa-plus-circle"></i> Add New Batch</a>
                <a href="#ai-assistant-section" class="nav-link"><i class="fas fa-robot"></i> AI Assistant</a>
                <a href="#settings-section" class="nav-link"><i class="fas fa-cog"></i> Settings</a>
            </nav>
            <div class="sidebar-footer">
                <div style="padding: 10px 0; color: #e0e0e0; font-size:0.9em; border-top: 1px solid rgba(255,255,255,0.05); margin-bottom:15px;">
                    Hop Valley Brewing <br> <span style="font-size:0.9em; color: #b0bec5;">Premium Plan</span>
                </div>
                <button id="logout-button" class="btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
                <span style="margin-top:15px;">Welcome, <strong id="brewery-name-display-sidebar">Brewery</strong>!</span>
            </div>
        </aside>

        <div id="dashboard-content-area">
            <header class="dashboard-header-main">
                <h1 id="current-section-title">Dashboard</h1>
                <div class="top-right-icons">
                    <i class="fas fa-bell icon-button" title="Notifications"></i>
                    <i class="fas fa-user-circle icon-button" title="User Profile"></i>
                </div>
            </header>

            <main class="dashboard-main-content">
                <section id="dashboard-overview-section" class="dashboard-section active-section">
                    <div class="whats-new-banner">
                        <h3>Welcome to your upgraded BrewMetrics dashboard!</h3>
                        <p>We've added new features to help you get even better feedback from your customers. Check out the batch comparison tool, customizable surveys, and Google review integration.</p>
                        <div class="buttons">
                            <button class="btn btn-primary">Take a tour</button>
                            <button class="btn btn-secondary">Dismiss</button>
                        </div>
                    </div>

                    <div class="main-dashboard-title-bar">
                        <h2>Dashboard</h2>
                        <div class="action-buttons">
                            <button class="btn btn-export"><i class="fas fa-download"></i> Export Data</button>
                            <button class="btn btn-secondary" onclick="window.open('recipe-designer.html', '_blank')">
                                <i class="fas fa-flask"></i> Recipe Designer
                            </button>
                            <button class="btn btn-secondary" onclick="window.open('inventory.html', '_blank')">
                                <i class="fas fa-boxes"></i> Inventory
                            </button>
                            <button class="btn btn-secondary" onclick="window.open('brewery-setup.html', '_blank')">
                                <i class="fas fa-cogs"></i> Equipment
                            </button>
                            <button class="btn btn-new-batch"><i class="fas fa-plus"></i> New Batch</button>
                        </div>
                    </div>

                    <div class="summary-cards-container">
                        <div class="summary-card card hover-lift" data-aos="fade-up" data-aos-delay="100">
                            <div class="summary-card-content">
                                <div class="summary-card-icon batches"><i class="fas fa-box-open"></i></div>
                                <div class="summary-card-info">
                                    <h4>Active Batches</h4>
                                    <div class="value" data-component="metric-card" data-config='{"value": 0}'>0</div>
                                </div>
                            </div>
                            <div class="summary-card-footer"><a href="#batch-management-section">View all</a></div>
                        </div>
                        <div class="summary-card card hover-lift" data-aos="fade-up" data-aos-delay="200">
                            <div class="summary-card-content">
                                <div class="summary-card-icon feedback"><i class="fas fa-comments"></i></div>
                                <div class="summary-card-info">
                                    <h4>Feedback Responses</h4>
                                    <div class="value" data-component="metric-card" data-config='{"value": 0}'>0</div>
                                </div>
                            </div>
                            <div class="summary-card-footer"><a href="#batch-management-section">View all</a></div>
                        </div>
                        <div class="summary-card card hover-lift" data-aos="fade-up" data-aos-delay="300">
                            <div class="summary-card-content">
                                <div class="summary-card-icon reviews"><i class="fas fa-star"></i></div>
                                <div class="summary-card-info">
                                    <h4>Google Reviews</h4>
                                    <div class="value">N/A <small>(0)</small></div>
                                </div>
                            </div>
                            <div class="summary-card-footer"><a href="#google-reviews-section">Manage reviews</a></div>
                        </div>
                        <div class="summary-card card hover-lift" data-aos="fade-up" data-aos-delay="400">
                            <div class="summary-card-content">
                                <div class="summary-card-icon discounts"><i class="fas fa-tags"></i></div>
                                <div class="summary-card-info">
                                    <h4>Active Discount Offers</h4>
                                    <div class="value" data-component="metric-card" data-config='{"value": 0}'>0</div>
                                </div>
                            </div>
                            <div class="summary-card-footer"><a href="#settings-section">Manage offers</a></div>
                        </div>
                    </div>

                    <div class="dashboard-section" style="display:block; background-color:transparent; box-shadow:none; padding:0; border-top: none;">
                        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                            <div class="dashboard-section card hover-lift" data-aos="fade-up" data-aos-delay="500" style="display:block; border-top: 4px solid var(--brew-brown);">
                                <h2><i class="fas fa-trophy"></i> Top Rated Beers</h2>
                                <div id="top-rated-beers-controls" style="margin-bottom: 10px;">
                                    <label for="top-rated-time-select">Time Period:</label>
                                    <select id="top-rated-time-select">
                                        <option value="overall" selected>Overall</option>
                                        <option value="last7days">Last 7 Days</option>
                                        <option value="last30days">Last 30 Days</option>
                                    </select>
                                </div>
                                <ul id="top-rated-beers-list" style="list-style: none; padding-left: 0;">
                                    <li>Loading...</li>
                                </ul>
                            </div>
                            <div class="dashboard-section card hover-lift" data-aos="fade-up" data-aos-delay="600" style="display:block; border-top: 4px solid var(--brew-link-blue);" onclick="window.location.href='inventory.html'" style="cursor: pointer;">
                                <h2><i class="fas fa-boxes"></i> Inventory Management</h2>
                                <p>Track ingredients, manage stock levels, and generate shopping lists for your brewery operations.</p>
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                                    <small style="color: var(--brew-amber); font-weight: bold;">Click to manage inventory →</small>
                                </div>
                            </div>
                            <div class="dashboard-section card hover-lift" data-aos="fade-up" data-aos-delay="700" style="display:block; border-top: 4px solid var(--brew-muted-green);" onclick="window.location.href='brewery-setup.html'" style="cursor: pointer;">
                                <h2><i class="fas fa-cogs"></i> Equipment Setup</h2>
                                <p>Configure your brewery equipment for optimized AI recipe generation and brewing efficiency.</p>
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                                    <small style="color: var(--brew-amber); font-weight: bold;">Click to configure equipment →</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="settings-section" class="dashboard-section">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-cog"></i> Settings</h2>
                        <button id="edit-brewery-button" class="btn btn-secondary btn-small">
                            <i class="fa-solid fa-pencil"></i> Edit Info
                        </button>
                    </div>
                    <p>Manage your brewery's profile, contact information, and integration settings.</p>
                    <div style="margin-top:15px; padding-top:15px; border-top: 1px dashed #eee;">
                        <h4>Brewery Profile:</h4>
                        <p><strong>Name:</strong> <span id="detail-brewery-name">Loading...</span></p>
                        <p><strong>Email:</strong> <span id="detail-email">Loading...</span> <small>(Cannot be changed after registration)</small></p>
                        <p><strong>Location:</strong> <span id="detail-location">Loading...</span></p>
                        <p><strong>Website:</strong> <span id="detail-website">Loading...</span></p>
                    </div>
                     <div style="margin-top:15px; padding-top:15px; border-top: 1px dashed #eee;">
                        <h4>Review & Feedback Settings:</h4>
                        <p><strong>Google My Business Link:</strong> <span id="detail-gmb-link">Loading...</span></p>
                        <p><strong>Google Review Incentive Text:</strong> <span id="detail-incentive-text">Loading...</span></p>
                         <p style="margin-top:10px; font-size:0.9em;"><strong>GMB Stats (Display Only):</strong>
                           Average: <span id="display-gmb-avg-rating">N/A</span>,
                           Total: <span id="display-gmb-total-reviews">0</span>
                           <br><small>Update these values in the 'Edit Info' modal if they change on your GMB page.</small>
                        </p>
                        <p style="font-size:0.9em;"><strong>Active Discount Offers (Display Only):</strong>
                           Count: <span id="display-active-discounts-count">0</span>
                           <br><small>Update this count in 'Edit Info' based on your current campaigns.</small>
                        </p>
                    </div>
                </section>

                <section id="ai-assistant-section" class="dashboard-section">
                    <div class="section-header">
                        <h2><i class="fas fa-robot"></i> Master Brewer AI Assistant</h2>
                        <div class="ai-status-indicator">
                            <span class="ai-status-dot"></span>
                            <span class="ai-status-text" id="ai-status-text">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="ai-chat-container">
                        <div class="ai-chat-messages" id="ai-messages">
                            <div class="ai-message ai-welcome">
                                <div class="ai-avatar">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div class="ai-message-content">
                                    <p><strong>Cheers! I'm your Master Brewer AI with 25+ years of professional brewing experience.</strong></p>
                                    <p>From grain to glass, I've got your back with expertise in:</p>
                                    <ul>
                                        <li><strong>Recipe Development:</strong> Grain bills, hop schedules, yeast selection for any style</li>
                                        <li><strong>Troubleshooting:</strong> Off-flavors, fermentation issues, process optimization</li>
                                        <li><strong>Professional Techniques:</strong> Water chemistry, advanced mashing, commercial scaling</li>
                                        <li><strong>Inventory Integration:</strong> Create recipes using your current ingredients</li>
                                    </ul>
                                    <p><strong>🍺 Fellow brewer to brewer:</strong> I work offline and understand the passion we share for exceptional beer.</p>
                                    <p>What's brewing? Let's craft something amazing together!</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ai-chat-input-container">
                            <input 
                                type="text" 
                                id="ai-prompt" 
                                placeholder="Ask me about brewing, recipes, or troubleshooting..."
                                maxlength="500"
                            >
                            <button id="ai-send" disabled>
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="ai-quick-actions">
                        <h4>Quick Actions:</h4>
                        <div class="quick-action-buttons">
                            <button class="ai-action-btn" data-action="generate-recipe">
                                <i class="fas fa-magic"></i> Generate Recipe
                            </button>
                            <button class="ai-action-btn" data-action="inventory-recipe">
                                <i class="fas fa-boxes"></i> Use My Inventory
                            </button>
                            <button class="ai-action-btn" data-action="enhance-recipe">
                                <i class="fas fa-star"></i> Enhance Recipe
                            </button>
                            <button class="ai-action-btn" data-action="troubleshoot">
                                <i class="fas fa-tools"></i> Troubleshoot Batch
                            </button>
                        </div>
                    </div>
                </section>

                <section id="qr-code-section" class="dashboard-section">
                    <h2><i class="fa-solid fa-qrcode"></i> Patron Survey QR Code</h2>
                    <p>Display this QR code for patrons to scan and provide feedback on your beers.</p>
                    <div id="qr-code-display" style="margin: 15px auto; text-align:center; background-color:white; padding:10px; border:1px solid #ddd; display:inline-block; min-width:180px; min-height:180px;"><p>Generating QR Code...</p></div>
                    <div id="qr-code-link-area" style="margin-top:15px;">
                        <input type="text" id="qr-code-link" readonly placeholder="Survey Link will appear here..." class="form-input" style="width:calc(100% - 100px); margin-right:10px;">
                        <button id="copy-link-button" title="Copy survey link" class="btn btn-info btn-small"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                    <span id="copy-status" class="form-message success-message hidden" style="margin-left:0; margin-top:10px;">Copied!</span>
                    <div class="qr-print-area" style="text-align: center; margin-top: 25px; padding-top:20px; border-top: 1px dashed #eee;">
                        <div style="margin-bottom: 15px;">
                            <label for="print-layout-select" style="margin-right: 8px; font-weight: 600;">Print Layout:</label>
                            <select id="print-layout-select" class="form-select" style="display: inline-block; width: auto; padding: 8px 12px; border-radius: var(--border-radius); border: 1px solid var(--medium-grey);">
                                <option value="auto" selected>Auto-Fit (Tiled)</option>
                                <option value="1x1">1 Code per Page (Large)</option>
                                <option value="2x2">2x2 Grid (4 Codes)</option>
                                <option value="3x3">3x3 Grid (9 Codes)</option>
                                <option value="4x4">4x4 Grid (16 Codes)</option>
                            </select>
                        </div>
                        <button id="print-qr-button" class="btn btn-secondary" style="padding: 10px 15px;" disabled>
                            <i class="fas fa-print" style="margin-right: 5px;"></i> Generate Printable QR Page
                        </button>
                    </div>
                </section>

                <section id="batch-entry-section" class="dashboard-section">
                     <h2><i class="fa-solid fa-beer-mug-empty"></i> Add New Beer Batch for Survey</h2>
                     <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 4px; padding: 15px; margin-bottom: 20px;">
                         <h4 style="color: #1565c0; margin-top: 0;"><i class="fas fa-star"></i> New: Professional Recipe Designer</h4>
                         <p style="color: #1976d2; margin-bottom: 10px;">Design complete recipes with ingredient management, brewing calculations, and style guidelines - just like professional brewing software!</p>
                         <button class="btn btn-primary" onclick="window.open('recipe-designer.html', '_blank')" style="margin-right: 10px;">
                             <i class="fas fa-flask"></i> Open Recipe Designer
                         </button>
                         <small style="color: #666;">Or use the simple form below for basic batch entry</small>
                     </div>
                     <form id="batch-entry-form">
                         <div class="form-group"><label for="beer-name">Beer Name*</label><input type="text" id="beer-name" required class="form-input"></div>
                         <div class="form-group"><label for="beer-intro">Brief Introduction / Description*</label><textarea id="beer-intro" rows="3" required placeholder="e.g., A crisp West Coast IPA with notes of citrus and pine..." class="form-input"></textarea></div>
                         <div class="form-row">
                            <div class="form-group"><label for="beer-abv">ABV (%)*</label><input type="number" id="beer-abv" step="0.1" min="0" max="30" required placeholder="e.g., 6.5" class="form-input"></div>
                            <div class="form-group"><label for="beer-ibu">IBU (Optional)</label><input type="number" id="beer-ibu" min="0" max="200" placeholder="e.g., 55" class="form-input"></div>
                         </div>
                         <div class="form-row">
                             <div class="form-group">
                                 <label for="batch-code">Batch Code*</label>
                                 <input type="text" id="batch-code" placeholder="e.g., WCIPA-003, 2024Q1LAGER" required class="form-input">
                                 <small class="help-text">A unique internal tracking code for this specific batch. Required.</small>
                             </div>
                            <div class="form-group"><label for="packaged-date">Packaged Date (Optional)</label><input type="date" id="packaged-date" class="form-input"><small class="help-text">Helps track feedback over time relative to packaging.</small></div>
                         </div>
                         <fieldset class="custom-questions-fieldset">
                             <legend>Custom Survey Questions (Optional)</legend>
                             <p><small>Add up to 3 custom questions for patrons to answer on a 1-5 scale. These are specific to this batch.</small></p>
                             <div class="form-group"><label for="custom-question-1">Custom Question 1</label><input type="text" id="custom-question-1" placeholder="e.g., How prominent was the hop aroma?" class="form-input"></div>
                             <div class="form-group"><label for="custom-question-2">Custom Question 2</label><input type="text" id="custom-question-2" placeholder="e.g., Did you find the finish balanced?" class="form-input"></div>
                             <div class="form-group"><label for="custom-question-3">Custom Question 3</label><input type="text" id="custom-question-3" placeholder="e.g., How would you rate the mouthfeel?" class="form-input"></div>
                         </fieldset>
                         <button type="submit" class="btn btn-primary" style="margin-top:15px;"><i class="fas fa-plus"></i> Add Batch to Survey List</button>
                         <div id="batch-entry-message" class="form-message hidden" style="margin-top:15px;"></div>
                     </form>
                </section>

                <section id="batch-management-section" class="dashboard-section">
                    <div class="section-header">
                        <h2><i class="fa-solid fa-boxes"></i> Batch List & Feedback</h2>
                        <div class="export-controls">
                            <button id="compare-batches-button" class="btn btn-secondary btn-small" disabled><i class="fas fa-chart-column"></i> Compare Selected (2)</button>
                            <button id="export-all-csv-button" class="btn btn-success btn-small" disabled><i class="fas fa-file-csv"></i> Export All Active (CSV)</button>
                            <div id="export-message" class="form-message hidden" style="display: inline-block; margin-left: 15px; padding: 5px 10px; font-size:0.9em;"></div>
                        </div>
                    </div>
                    <div id="feedback-loading" style="text-align:center; padding:20px; font-style:italic; color:var(--dark-grey);">Loading batch feedback...</div>
                    <div id="feedback-error" class="error-message section-specific-error hidden"></div>
                    <div id="feedback-summary-container">
                        <p style="font-size:0.9em; color:var(--dark-grey); margin-bottom:15px;">Manage your beer batches. Toggle active status, view detailed responses, analyze feedback, and export data. Select two batches to enable comparison.</p>
                        <ul style="list-style:none; padding-left:0;">
                            <li class="feedback-summary-item" data-id="YOUR_BATCH_ID_HERE" data-active="true" style="display:none;">
                                <div class="feedback-item-header">
                                    <input type="checkbox" class="compare-checkbox" data-batch-id="YOUR_BATCH_ID_HERE" title="Select for comparison">
                                    <h4 class="beer-name">Hazy IPA</h4> <span class="batch-code">(Code: HAZEIPA-001)</span> <span class="status-indicator active">ACTIVE</span> </div>

                                <div class="batch-general-stats">
                                    <div class="stat-item">
                                        <i class="fas fa-comments"></i>
                                        <span class="stat-label">Responses:</span>
                                        <span class="stat-value">4</span>
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-star"></i>
                                        <span class="stat-label">Overall Avg:</span>
                                        <span class="stat-value">4.5</span>
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-percent"></i>
                                        <span class="stat-label">ABV:</span>
                                        <span class="stat-value">6.5%</span>
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-leaf"></i> <span class="stat-label">IBU:</span>
                                        <span class="stat-value">55</span>
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span class="stat-label">Packaged:</span>
                                        <span class="stat-value">2025-05-01</span>
                                    </div>
                                    </div>

                                <div class="taste-profile-details">
                                    <h5>Taste Profile Averages</h5>
                                    <div class="taste-profile-grid">
                                        </div>
                                </div>

                                <div class="feedback-item-actions">
                                    <button class="btn btn-secondary btn-small view-feedback-details-button" data-batch-id="YOUR_BATCH_ID_HERE">
                                        <i class="fas fa-eye"></i> View Details
                                    </button>
                                    <button class="btn btn-primary btn-small export-single-csv-button" data-batch-id="YOUR_BATCH_ID_HERE">
                                        <i class="fas fa-file-csv"></i> Export CSV
                                    </button>
                                    <button class="btn btn-danger btn-small toggle-active-button" data-batch-id="YOUR_BATCH_ID_HERE" data-current-status="true">
                                        <i class="fas fa-toggle-off"></i> Deactivate
                                        </button>
                                    <button class="icon-button analyze-batch-button" title="Analyze Batch Feedback" data-batch-id="YOUR_BATCH_ID_HERE">
                                        <i class="fas fa-chart-bar"></i>
                                    </button>
                                    <button class="icon-button edit-batch-button" title="Edit Batch Info (Coming Soon)" data-batch-id="YOUR_BATCH_ID_HERE" disabled>
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>

                                <div class="batch-analytics-area" id="analytics-YOUR_BATCH_ID_HERE">
                                    </div>
                            </li>

                            <li class="no-data" style="display: none;">No batches found. Add one to get started!</li> 
                        </ul>
                    </div>
                </section>

                <section id="survey-templates-section" class="dashboard-section"><h2><i class="fas fa-file-alt"></i> Survey Templates</h2><p>Manage and create survey templates. (Coming Soon)</p></section>
                <section id="customer-engagement-section" class="dashboard-section"><h2><i class="fas fa-users"></i> Customer Engagement</h2><p>View insights and tools for customer engagement. (Coming Soon)</p></section>
                <section id="google-reviews-section" class="dashboard-section">
                    <!-- Google Reviews content will be dynamically populated by google-reviews.js -->
                </section>
                <section id="advanced-analytics-section" class="dashboard-section">
                    <!-- Advanced Analytics content will be dynamically populated -->
                </section>
                <section id="batch-comparison-section" class="dashboard-section"><h2><i class="fas fa-balance-scale"></i> Batch Comparison Hub</h2><p>Select batches from 'Batch Management' to compare them here in more detail. (Coming Soon - Current comparison is via modal)</p></section>

            </main>

            <footer class="dashboard-footer-main">
                <p>© <span id="copyright-year">2024</span> BrewMetrics. Simple Beer Feedback.</p>
            </footer>
        </div>
    </div>

    <div id="edit-brewery-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button type="button" class="close-modal-button" id="close-edit-modal" aria-label="Close">×</button>
            <h2>Edit Brewery Information</h2>
            <form id="edit-brewery-form">
                <div class="form-group">
                    <label for="edit-brewery-name">Brewery Name*</label>
                    <input type="text" id="edit-brewery-name" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="edit-location">Location (City, ST)*</label>
                    <input type="text" id="edit-location" required placeholder="e.g., Austin, TX" class="form-input">
                </div>
                <div class="form-group">
                    <label for="edit-website">Website URL (Optional)</label>
                    <input type="url" id="edit-website" placeholder="https://www.yourbrewery.com" class="form-input">
                </div>
                <div class="form-group">
                    <label for="edit-gmb-link">Google Review Link (Optional)</label>
                    <input type="url" id="edit-gmb-link" placeholder="Link from your Google My Business profile" class="form-input">
                </div>
                <div class="form-group">
                    <label for="edit-incentive-text">Google Review Incentive Text (Optional)</label>
                    <textarea id="edit-incentive-text" rows="2" placeholder="e.g., Show review for $1 off!" class="form-input"></textarea>
                    <small class="help-text">Shown on survey 'Thank You' page if GMB link is provided.</small>
                </div>

                <h4 style="margin-top:20px; margin-bottom:10px; border-top:1px dashed #ccc; padding-top:15px;">Dashboard Card Display Values:</h4>
                 <p><small>Optionally, update these values to reflect your current GMB stats and active discount offers on the main dashboard cards. This app does not fetch GMB reviews automatically.</small></p>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-gmb-avg-rating">GMB Avg. Rating (for Card)</label>
                        <input type="number" id="edit-gmb-avg-rating" step="0.1" min="0" max="5" placeholder="e.g., 4.5" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="edit-gmb-total-reviews">GMB Total Reviews (for Card)</label>
                        <input type="number" id="edit-gmb-total-reviews" min="0" placeholder="e.g., 42" class="form-input">
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-active-discounts-count">Active Discount Offers (Count for Card)</label>
                    <input type="number" id="edit-active-discounts-count" min="0" placeholder="e.g., 3" class="form-input">
                    <small class="help-text">Number of distinct discount campaigns you're currently running.</small>
                </div>


                <div class="form-actions" style="margin-top:20px;">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Changes</button>
                    <button type="button" id="cancel-edit-button" class="btn btn-secondary"><i class="fas fa-times"></i> Cancel</button>
                </div>
                <div id="edit-brewery-message" class="form-message hidden" style="margin-top:15px;"></div>
            </form>
        </div>
    </div>

    <div id="feedback-detail-modal" class="feedback-detail-modal">
        <div class="modal-content">
            <button type="button" class="close-modal-button" id="close-feedback-detail-modal" aria-label="Close">×</button>
            <h3 id="feedback-detail-title">Detailed Feedback for: [Batch Name]</h3>
            <div class="controls">
                <label for="sort-responses-select">Sort by:</label>
                <select id="sort-responses-select" class="form-select" style="display: inline-block; width: auto; padding: 6px 10px;">
                    <option value="respondedAt_desc" selected>Newest First</option>
                    <option value="respondedAt_asc">Oldest First</option>
                    <option value="overallRating_desc">Highest Rating First</option>
                    <option value="overallRating_asc">Lowest Rating First</option>
                </select>
                <div id="response-count-display" style="margin-left: auto; font-weight: 600;"></div>
            </div>
            <div id="feedback-detail-loading" style="display: none; text-align: center; padding: 20px; font-style:italic;">Loading responses... <i class="fas fa-spinner fa-spin"></i></div>
            <div id="feedback-detail-error" class="error-message hidden" style="margin-bottom: 15px;"></div>
            <div class="feedback-table-container">
                <table id="feedback-detail-table" class="feedback-table">
                    <thead><tr></tr></thead>
                    <tbody id="feedback-detail-tbody"><tr><td colspan="10">Loading details...</td></tr></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="comparison-modal" class="comparison-modal">
        <div class="modal-content">
             <button type="button" class="close-modal-button" id="close-comparison-modal" aria-label="Close">×</button>
             <h2>Batch Comparison</h2>
             <div id="comparison-loading" style="display: none; text-align: center; padding: 30px; font-style:italic;">Loading comparison data... <i class="fas fa-spinner fa-spin"></i></div>
             <div id="comparison-error" class="error-message hidden" style="margin-bottom: 15px;"></div>
             <div id="comparison-content-area" class="comparison-grid">
                <div class="comparison-column">
                  <h3 id="compare-batch1-name">[Batch 1 Name]</h3>
                  <h5>Overall Rating Distribution</h5><canvas id="compare-dist-chart-1"></canvas>
                  <h5>Rating Trend Over Time</h5><canvas id="compare-trend-chart-1"></canvas>
                  <div id="compareTrendMsg1" class="chart-message"></div>
                  <h5>Taste/Mouthfeel Profile</h5><canvas id="compare-profile-chart-1"></canvas>
                  <div class="chart-container">
                      <h5>Taste Attribute Trends</h5>
                      <canvas id="compare-taste-attribute-trend-chart-1"></canvas>
                      <div id="compareTasteAttributeTrendMsg1" class="chart-message"></div>
                  </div>
                </div>
                <div class="comparison-column">
                  <h3 id="compare-batch2-name">[Batch 2 Name]</h3>
                  <h5>Overall Rating Distribution</h5><canvas id="compare-dist-chart-2"></canvas>
                  <h5>Rating Trend Over Time</h5><canvas id="compare-trend-chart-2"></canvas>
                  <div id="compareTrendMsg2" class="chart-message"></div>
                  <h5>Taste/Mouthfeel Profile</h5><canvas id="compare-profile-chart-2"></canvas>
                  <div class="chart-container">
                      <h5>Taste Attribute Trends</h5>
                      <canvas id="compare-taste-attribute-trend-chart-2"></canvas>
                      <div id="compareTasteAttributeTrendMsg2" class="chart-message"></div>
                  </div>
                </div>
             </div>
         </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-functions-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDmvUqgMlnaQFiyqlo50D66fX0Bwav3j1k",
            authDomain: "brewmetrics-xyz-app-e8d51.firebaseapp.com",
            projectId: "brewmetrics-xyz-app-e8d51",
            storageBucket: "brewmetrics-xyz-app-e8d51.appspot.com",
            messagingSenderId: "391623246374",
            appId: "1:391623246374:web:3b8e39db5fff674befdce7",
            measurementId: "G-MHT3H2ZVRY"
        };

        let auth, db, functions; 
        try {
            if (!firebase.apps.length) {
                 firebase.initializeApp(firebaseConfig);
            } else {
                 firebase.app(); 
            }
            auth = firebase.auth();
            db = firebase.firestore();
            functions = firebase.functions();
            console.log("Firebase Initialized on Dashboard Page with Functions!");
        } catch (e) {
            console.error("Error initializing Firebase:", e);
            const loadingDiv = document.getElementById('loading-indicator');
            if(loadingDiv) loadingDiv.innerHTML = '<p class="error-message" style="padding:20px;">Critical Error: Could not connect to Firebase services. Please ensure your Firebase configuration is correct and try refreshing.</p>';
        }
    </script>
    <script>
        const currentYear = new Date().getFullYear();
        const copyrightYearSpan = document.getElementById('copyright-year');
        if (copyrightYearSpan) copyrightYearSpan.textContent = currentYear;
    </script>
    <!-- Load utilities first -->
    <script src="utils.js"></script>
    <script src="analytics.js"></script>
    <script src="dashboard.js"></script>
    
    <!-- AI Brewmaster Integration -->
    <script src="brewing_knowledge_expansion.js"></script>
    <script src="offline-knowledge-base.js"></script>
    <script src="ai-brewmaster.js"></script>
    <script src="ai-brewmaster-ui.js"></script>
    
    <!-- Google Reviews Integration -->
    <script src="google-reviews.js"></script>
    
    <!-- Demo Tour System -->
    <script src="demo-tour.js"></script>
    
    <!-- Advanced Analytics System -->
    <script src="real-analytics.js"></script>
    <script src="advanced-analytics.js"></script>
    
    <!-- Enhanced UI Scripts -->
    <script src="enhanced-ui.js"></script>
    <script src="demo-upgrade.js"></script>
    <script src="advanced-components.js"></script>
    
    <!-- Brewery Theme Scripts -->
    <script src="brewery-animations.js"></script>
    
    <script>
        // Initialize Enhanced UI Features
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize AOS (Animate On Scroll)
            if (typeof AOS !== 'undefined') {
                AOS.init({
                    duration: 800,
                    easing: 'ease-out-cubic',
                    once: true,
                    offset: 100
                });
            }
            
            // Brewery particles will be initialized by brewery-animations.js
            
            // Initialize Tooltips
            if (typeof tippy !== 'undefined') {
                tippy('[title]', {
                    theme: 'brewmetrics',
                    animation: 'scale'
                });
            }
            
            // Monitor AI Assistant and Knowledge Base status
            function updateAIStatus() {
                const statusText = document.getElementById('ai-status-text');
                if (!statusText) return;
                
                if (window.offlineKnowledgeBase && window.offlineKnowledgeBase.isLoaded) {
                    const stats = window.offlineKnowledgeBase.getStats();
                    statusText.textContent = `Ready (${stats.totalDocuments} docs loaded)`;
                    statusText.title = `Offline knowledge base loaded with ${stats.totalDocuments} brewing documents`;
                } else if (window.AIBrewmaster && window.AIBrewmaster.isInitialized) {
                    statusText.textContent = 'Ready (Online mode)';
                    statusText.title = 'AI Assistant ready - online mode';
                } else {
                    statusText.textContent = 'Loading...';
                }
            }
            
            // Check status periodically
            const statusInterval = setInterval(() => {
                updateAIStatus();
                if (window.offlineKnowledgeBase && window.offlineKnowledgeBase.isLoaded) {
                    clearInterval(statusInterval);
                }
            }, 500);
            
            // Enhanced button interactions
            setTimeout(() => {
                if (window.enhancedUI) {
                    window.enhancedUI.enhance();
                }
                
                // Initialize brewery enhancements
                if (window.breweryAnimations) {
                    window.breweryAnimations.enhanceBreweryElements();
                }
            }, 1000);
        });
    </script>
    
    <!-- AI Brewmaster Container -->
    <div id="ai-brewmaster-container"></div>
    <footer id="contact-footer">
        <div class="container footer-container">
            <p>Contact: brewcrew@brewmetrics.com | (928)298-5415 </p>
            <p>Follow us: https://www.instagram.com/brew.metrics.app/</p>
            <div class="legal-links">
                <a href="public/privacy-policy.html">Privacy Policy</a> |
                <a href="public/terms-of-service.html">Terms of Service</a> |
                <a href="public/cookie-policy.html">Cookie Policy</a> |
                <a href="public/disclaimer.html">Disclaimer</a> |
                <a href="public/refund-cancellation-policy.html">Refund & Cancellation Policy</a>
            </div>
            <p class="copyright">© <span id="footer-copyright-year-alt">2024</span> BrewMetrics</p>
             <script>document.getElementById('footer-copyright-year-alt').textContent = new Date().getFullYear();</script>
        </div>
    </footer>

</body>
</html>